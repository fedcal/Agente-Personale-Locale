<div class="chat-window">
  <div class="messages" #messagesContainer>
    <div *ngFor="let msg of messages" class="bubble" [class.user]="msg.role === 'user'" [class.assistant]="msg.role === 'assistant'">
      <div class="meta">{{ msg.role === 'user' ? 'Tu' : 'ARES' }}</div>
      <div class="markdown" [innerHTML]="msg.text | markdown"></div>
    </div>
    <div *ngIf="!messages.length" class="placeholder">
      <div class="emoji">ğŸ¤–</div>
      <div class="title">Pronto ad aiutarti</div>
      <div class="subtitle">Scegli un modello, scrivi un messaggio o usa il microfono per dettare.</div>
      <ul>
        <li>Scrivi ciÃ² che vuoi chiedere o descrivere</li>
        <li>Premi Invio o il pulsante "Invia"</li>
        <li>Clicca ğŸ¤ per dettare (se supportato)</li>
      </ul>
    </div>
  </div>

  <div class="status">
    <span *ngIf="loading" class="spinner"></span>
    <span *ngIf="listening">ğŸ™ï¸ Ascolto in corso...</span>
    <span *ngIf="!listening && hasSpeech && !loading">ğŸ¤ Usa il microfono per dettare</span>
    <span *ngIf="!hasSpeech && !loading">Il tuo browser non supporta la dettatura</span>
  </div>

  <div class="input-area">
    <div class="input-stack">
      <div class="command-overlay" *ngIf="showCommands">
        <app-command-hint
          [visible]="true"
          [commands]="commands"
          (onSelect)="pickCommand($event)">
        </app-command-hint>
      </div>

      <div class="input-row">
        <input [(ngModel)]="userInput"
               placeholder="Scrivi un messaggio o usa il microfono..."
               (keyup.enter)="send()"
               (input)="onInputChange()" />
        <div class="actions">
          <button class="ghost" [disabled]="!hasSpeech" [class.active]="listening" (click)="toggleVoice()">
            {{ listening ? 'Stop' : 'ğŸ¤' }}
          </button>
          <button (click)="send()">Invia</button>
        </div>
      </div>
    </div>
  </div>
</div>
